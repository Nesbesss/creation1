<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=240, height=282, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>R1 Chat</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div id="app">
        <header>
            <h1 id="page-title">R1 Chat</h1>
            <button id="menu-btn">☰</button>
        </header>
        
        <!-- Navigation Menu -->
        <div id="menu">
            <ul>
                <li data-page="chats-page" class="nav-item active">Chats</li>
                <li data-page="friends-page" class="nav-item">Friends</li>
                <li data-page="profile-page" class="nav-item">Profile</li>
            </ul>
        </div>
        
        <main id="content">
            <!-- Onboarding Screen -->
            <div id="onboarding" class="page">
                <div class="onboarding-container">
                    <h2>Welcome to R1 Chat</h2>
                    <p>Let's set up your profile</p>
                    <form id="profileForm" onsubmit="return false;">
                        <div class="form-group">
                            <label for="username-input">Username</label>
                            <input type="text" id="username-input" placeholder="Enter username" required>
                        </div>
                        <div class="form-group">
                            <label for="status-input">Status</label>
                            <input type="text" id="status-input" placeholder="What's on your mind?">
                        </div>
                        <button type="button" id="save-profile-btn" onclick="saveProfileHandler()">SAVE PROFILE</button>
                    </form>
                    
                    <script>
                        function saveProfileHandler() {
                            console.log('Save profile clicked via inline handler');
                            const username = document.getElementById('username-input').value.trim();
                            if (!username) {
                                alert('Username is required');
                                return;
                            }
                            const status = document.getElementById('status-input').value.trim() || 'Available';
                            
                            // Create user object
                            const user = {
                                username: username,
                                status: status,
                                created: new Date().toISOString(),
                                lastActive: new Date().toISOString()
                            };
                            
                            console.log('Saving user:', user);
                            
                            // Save to localStorage
                            localStorage.setItem('r1_chat_user', JSON.stringify(user));
                            console.log('User saved to localStorage');
                            
                            // Show success message
                            alert('Profile saved successfully!');
                            
                            // Manually navigate to chats page
                            const pages = document.querySelectorAll('.page');
                            pages.forEach(p => p.classList.remove('active'));
                            
                            const chatsPage = document.getElementById('chats-page');
                            if (chatsPage) {
                                chatsPage.classList.add('active');
                                console.log('Navigated to chats page');
                            }
                            
                            // Update page title
                            const pageTitle = document.getElementById('page-title');
                            if (pageTitle) pageTitle.textContent = 'R1 Chat';
                        }
                    </script>
                </div>
            </div>
            
            <!-- Chats Page -->
            <div id="chats-page" class="page hidden">
                <div class="chat-list" id="chat-list">
                    <!-- Chat items will be added here dynamically -->
                    <div class="empty-state">
                        <p>No conversations yet</p>
                        <p>Add friends to start chatting</p>
                    </div>
                </div>
            </div>
            
            <!-- Friends Page -->
            <div id="friends-page" class="page hidden">
                <div class="friends-header">
                    <h2>Friends</h2>
                    <span id="friend-count">0</span>
                </div>
                <div class="friends-list" id="friends-list">
                    <!-- Friends will be added here dynamically -->
                </div>
                <div class="add-friend">
                    <input type="text" id="friend-name" placeholder="Enter friend's username">
                    <button id="add-friend-btn">Add</button>
                </div>
            </div>
            
            <!-- Profile Page -->
            <div id="profile-page" class="page hidden">
                <div class="profile-container">
                    <div class="profile-header">
                        <div class="avatar">
                            <span id="profile-initial"></span>
                        </div>
                        <div class="profile-info">
                            <h3 id="profile-username">Username</h3>
                            <p id="profile-status">Status</p>
                        </div>
                    </div>
                    <div class="profile-actions">
                        <button id="edit-profile-btn">Edit Profile</button>
                    </div>
                </div>
            </div>
            
            <!-- Chat Detail Page -->
            <div id="chat-detail" class="page hidden">
                <div class="chat-header">
                    <button id="back-btn">←</button>
                    <div class="chat-user">
                        <h3 id="chat-username">Friend</h3>
                        <p id="chat-status" class="status">Online</p>
                    </div>
                </div>
                <div class="messages" id="messages">
                    <!-- Messages will be added here dynamically -->
                </div>
                <div class="message-input">
                    <input type="text" id="message-input" placeholder="Type a message...">
                    <button id="send-btn">Send</button>
                </div>
            </div>
        </main>
        
        <footer>
            <div id="status-message">Ready</div>
        </footer>
    </div>
    
    <script src="js/chat.js"></script>
</body>
</html>
